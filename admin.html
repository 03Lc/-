<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Live Updates</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg-dark:#0a0e23;
  --accent:#6e45e2;
  --accent-alt:#11d8c6;
  --text-light:#f1f1f1;
  --glass-bg:rgba(255,255,255,0.07);
  --glass-border:rgba(255,255,255,0.15);
  --shadow-glow:rgba(110,69,226,0.4);
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Montserrat',sans-serif;}
body{background:radial-gradient(circle at bottom,var(--bg-dark),#000);color:var(--text-light);min-height:100vh;display:flex;justify-content:center;align-items:center;overflow:hidden;}
a{color:inherit;text-decoration:none;}
.card{background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:15px;backdrop-filter:blur(15px);box-shadow:0 0 30px var(--shadow-glow);padding:2rem;width:100%;max-width:480px;animation:fadeIn 0.8s ease;transition:transform 0.3s;}
.card:hover{transform:translateY(-5px);}
#login-screen{display:none;}
#login-screen.active{display:block;text-align:center;position:relative;}
#login-screen img{height:80px;margin-bottom:1rem;border-radius:15px;}
#login-screen h2{color:var(--accent-alt);font-size:1.8rem;margin-bottom:0.2rem;}
#login-screen p{font-size:0.9rem;color:#aaa;margin-bottom:1.5rem;}
.form-group{margin-bottom:1rem;text-align:left;}
label{display:block;font-weight:600;color:var(--accent);margin-bottom:0.3rem;font-size:0.9rem;}
input{width:100%;padding:0.8rem 1rem;border-radius:10px;border:none;outline:none;font-size:1rem;background:rgba(255,255,255,0.1);color:white;transition:0.3s;}
input:focus{background:rgba(255,255,255,0.15);}
.login-btn{width:100%;padding:0.9rem;background:linear-gradient(45deg,var(--accent),var(--accent-alt));border:none;border-radius:50px;color:white;font-weight:600;font-size:1.1rem;cursor:pointer;transition:0.3s;}
.login-btn:hover{opacity:0.9;transform:translateY(-2px);}
.error{background:rgba(255,69,58,0.3);padding:0.6rem;margin-bottom:1rem;border-radius:8px;color:white;font-weight:600;display:none;text-align:center;}
#close-login{position:absolute;top:10px;right:15px;font-size:1.2rem;color:#fff;background:rgba(255,255,255,0.1);border:none;border-radius:50%;width:30px;height:30px;cursor:pointer;transition:0.3s;}
#close-login:hover{background:rgba(255,69,58,0.6);}
#dashboard{display:none;flex-direction:row;width:100%;height:100vh;}
#dashboard.active{display:flex;}
.sidebar{width:250px;background:var(--glass-bg);border-right:1px solid var(--glass-border);backdrop-filter:blur(15px);display:flex;flex-direction:column;padding:2rem 1rem;}
.sidebar h2{color:var(--accent-alt);margin-bottom:2rem;font-size:1.5rem;text-align:center;}
.sidebar a{padding:0.8rem 1rem;border-radius:10px;margin-bottom:0.5rem;transition:0.3s;display:block;}
.sidebar a:hover,.sidebar a.active{background:rgba(110,69,226,0.3);}
.main{flex:1;padding:2rem;overflow-y:auto;}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;flex-wrap:wrap;}
.header h1{font-size:2rem;color:var(--accent-alt);}
.logout-btn{padding:0.6rem 1.5rem;background:linear-gradient(45deg,var(--accent),var(--accent-alt));border:none;border-radius:50px;color:white;font-weight:600;cursor:pointer;transition:0.3s;}
.logout-btn:hover{opacity:0.9;transform:translateY(-2px);}
.section{background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:15px;padding:1.8rem;margin-bottom:2rem;backdrop-filter:blur(15px);box-shadow:0 0 25px rgba(110,69,226,0.25);transition:transform 0.3s;}
.section:hover{transform:translateY(-3px);}
.section h2{display:flex;justify-content:space-between;align-items:center;font-size:1.6rem;color:var(--accent-alt);margin-bottom:1rem;}
.badge{background:var(--accent-alt);color:#000;font-size:0.85rem;padding:0.3rem 0.7rem;border-radius:25px;}
.messages{display:flex;flex-direction:column;gap:1rem;max-height:500px;overflow-y:auto;}
.message{background:rgba(255,255,255,0.07);padding:1rem;border-radius:12px;border-left:4px solid var(--accent);transition:all 0.3s;}
.message.unread{border-left-color:var(--accent-alt);}
.message-header{display:flex;justify-content:space-between;margin-bottom:0.5rem;flex-wrap:wrap;}
.message-name{font-weight:600;color:var(--accent-alt);}
.message-email{font-size:0.85rem;opacity:0.8;}
.message-date{font-size:0.8rem;opacity:0.6;}
.message-content{margin-top:0.5rem;}
.actions{display:flex;gap:0.6rem;margin-top:0.8rem;}
.btn{padding:0.4rem 0.9rem;border:none;border-radius:6px;cursor:pointer;font-size:0.85rem;font-weight:500;transition:0.3s;}
.btn-read{background:rgba(110,69,226,0.3);color:white;}
.btn-read:hover{background:rgba(110,69,226,0.5);}
.btn-delete{background:rgba(255,69,58,0.3);color:white;}
.btn-delete:hover{background:rgba(255,69,58,0.5);}
.search-bar{margin-bottom:1rem;display:flex;gap:0.5rem;}
.search-bar input{flex:1;padding:0.7rem 1rem;border-radius:10px;border:none;outline:none;background:rgba(255,255,255,0.1);color:white;}
.search-bar input:focus{background:rgba(255,255,255,0.15);}
.search-bar button{padding:0.7rem 1rem;border:none;border-radius:50px;background:var(--accent-alt);color:#000;font-weight:600;cursor:pointer;transition:0.3s;}
.search-bar button:hover{opacity:0.9;}
#new-msg-popup{position:fixed;top:20px;right:20px;background:var(--accent-alt);color:#000;padding:0.8rem 1.2rem;border-radius:12px;box-shadow:0 0 15px rgba(110,69,226,0.5);font-weight:600;opacity:0;pointer-events:none;transition:transform 0.4s, opacity 0.4s;transform:translateY(-20px);z-index:1000;}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
@keyframes newMsg{0%{transform:translateX(100%);opacity:0;}50%{transform:translateX(-10px);opacity:1;}100%{transform:translateX(0);opacity:1;}}
.message.new{animation:newMsg 0.5s ease;}
@media(max-width:900px){#dashboard{flex-direction:column;}.sidebar{width:100%;flex-direction:row;justify-content:space-around;padding:1rem;border-right:none;border-bottom:1px solid var(--glass-border);}.sidebar a{margin-bottom:0;}}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="login-screen" class="card active">
  <button id="close-login" onclick="closeLogin()">√ó</button>
  <img src="lc-logo.png" alt="Logo">
  <h2>Admin Login</h2>
  <p>Secure access to your dashboard üöÄ</p>
  <div id="error-message" class="error">Invalid username or password</div>
  <form onsubmit="return handleLogin(event)">
    <div class="form-group">
      <label for="username">Username</label>
      <input id="username" type="text" placeholder="Enter username" required>
    </div>
    <div class="form-group">
      <label for="password">Password</label>
      <input id="password" type="password" placeholder="Enter password" required>
    </div>
    <button type="submit" class="login-btn">Login</button>
  </form>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <div class="sidebar">
    <h2>Admin Panel</h2>
    <a href="#" class="active" onclick="showSection('messages-section')">Messages</a>
    <a href="#" onclick="exportCSV()">Export CSV</a>
    <a href="#" onclick="logout()">Logout</a>
  </div>
  <div class="main">
    <div class="header">
      <h1>Dashboard</h1>
    </div>
    <div class="section" id="messages-section">
      <h2>Messages <span class="badge" id="unread-count">0</span></h2>
      <div class="search-bar">
        <input type="text" id="search-input" placeholder="Search messages...">
        <button onclick="searchMessages()">Search</button>
      </div>
      <div class="messages" id="messages-list"></div>
    </div>
  </div>
</div>

<div id="new-msg-popup"></div>

<script>
const ADMIN_USERNAME="admin";
const ADMIN_PASSWORD="12345";
const loginScreen=document.getElementById("login-screen");
const dashboard=document.getElementById("dashboard");
let messages = [];

// LOGIN
function handleLogin(e){
  e.preventDefault();
  const username=document.getElementById("username").value.trim();
  const password=document.getElementById("password").value.trim();
  const errorEl=document.getElementById("error-message");
  if(username===ADMIN_USERNAME && password===ADMIN_PASSWORD){
    showDashboard();
  } else errorEl.style.display="block";
}

function closeLogin(){ loginScreen.style.display="none"; }
function showDashboard(){ loginScreen.classList.remove("active"); dashboard.classList.add("active"); fetchMessages(); }
function logout(){ dashboard.classList.remove("active"); loginScreen.classList.add("active"); document.getElementById("error-message").style.display="none"; document.getElementById("username").value=""; document.getElementById("password").value=""; }

// FETCH FORM-SPREE MESSAGES
async function fetchMessages(){
  try{
    // Replace FORM_ID & API_TOKEN with your Formspree details
    const response = await fetch('https://formspree.io/api/forms/YOUR_FORM_ID/submissions',{
      headers:{'Authorization':'Bearer YOUR_API_TOKEN'}
    });
    const data = await response.json();
    messages = data.submissions.map(s => ({
      name: s.data.name || "Anonymous",
      email: s.data.email || "No email",
      message: s.data.message || "",
      date: s.created_at,
      read: false
    }));
    renderMessages();
  }catch(err){ console.error(err); alert("Failed to fetch messages."); }
}

// RENDER
function renderMessages(filtered=messages){
  const list=document.getElementById("messages-list");
  const unreadCountEl=document.getElementById("unread-count");
  list.innerHTML="";
  let unreadCount=0;
  filtered.forEach((msg,index)=>{
    if(!msg.read) unreadCount++;
    const div=document.createElement("div");
    div.className="message "+(msg.read?"":"unread");
    div.innerHTML=`
      <div class="message-header">
        <div><span class="message-name">${msg.name}</span> <span class="message-email">${msg.email}</span></div>
        <span class="message-date">${new Date(msg.date).toLocaleString()}</span>
      </div>
      <div class="message-content">${msg.message}</div>
      <div class="actions">
        <button class="btn btn-read">${msg.read?"Mark Unread":"Mark Read"}</button>
        <button class="btn btn-delete">Delete</button>
      </div>
    `;
    div.querySelector(".btn-read").addEventListener("click",()=>{ msg.read=!msg.read; renderMessages(); });
    div.querySelector(".btn-delete").addEventListener("click",()=>{ messages.splice(index,1); renderMessages(); });
    list.prepend(div);
  });
  unreadCountEl.textContent=unreadCount;
}

// SEARCH
function searchMessages(){
  const query=document.getElementById("search-input").value.toLowerCase();
  const filtered=messages.filter(m=>m.name.toLowerCase().includes(query) || m.email.toLowerCase().includes(query) || m.message.toLowerCase().includes(query));
  renderMessages(filtered);
}

// EXPORT CSV
function exportCSV(){
  if(messages.length===0){ alert("No messages to export"); return; }
  const csv=["Name,Email,Message,Date,Read"];
  messages.forEach(m=>{ csv.push(`"${m.name}","${m.email}","${m.message}","${m.date}","${m.read}"`) });
  const blob=new Blob([csv.join("\n")],{type:"text/csv"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download="messages.csv"; a.click();
  URL.revokeObjectURL(url);
}

// SHOW SECTION
function showSection(sectionId){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById(sectionId).style.display="block";
  document.querySelectorAll(".sidebar a").forEach(a=>a.classList.remove("active"));
  event.target.classList.add("active");
}


//admin back

function closeLogin() {
    // Try to close the window (works if opened with window.open)
    window.close();

    // Fallback: If closing fails, redirect back to your main website
    setTimeout(() => {
        window.location.href = "https://sudarshansharma.com.np"; // ‚Üê replace this
    }, 150);
}


</script>
</body>
</html>
